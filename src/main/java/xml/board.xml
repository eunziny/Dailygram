<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kitri.daily.board.BoardMapper">

	<resultMap id="BoardResult" type="com.kitri.daily.board.Board">
		<result column="board_seq" property="board_seq" />
		<result column="writer" property="writer" />
		<result column="content" property="content" />
		<result column="posted" property="posted" />
		<result column="img" property="img" />
		<result column="public_yn" property="public_yn" />
	</resultMap>

	<resultMap id="CommentResult" type="com.kitri.daily.board.Comment">
		<result column="board_seq" property="board_seq" />
		<result column="com_seq" property="com_seq" />
		<result column="ref" property="ref" />
		<result column="lev" property="lev" />
		<result column="step" property="step" />
		<result column="pseq" property="pseq" />
		<result column="reply" property="reply" />
		<result column="content" property="content" />
	</resultMap>

	<select id="select" resultMap="BoardResult" parameterType="java.lang.Integer">
		select * from board where
		board_seq = #{board_seq}
	</select>

	<insert id="insert" parameterType="com.kitri.daily.board.Board">
		insert into board (`writer`,
		`content`, `posted`, `img`, `public_yn`)
		values (#{writer}, #{content},
		now(), #{img}, #{public_yn})
	</insert>

	<update id="update" parameterType="com.kitri.daily.board.Board">
		update board
		set
		content=#{content}, img=#{img}, public_yn=#{public_yn}
		where
		board_seq=#{board_seq}
	</update>

	<delete id="delete" parameterType="String">
		delete board
		where
		writer=#{writer} and board_seq=#{board_seq}
	</delete>

	<select id="myList" resultMap="BoardResult" parameterType="String">
		select * from board where writer=#{writer}
	</select>

	<select id="selectComments" resultMap="CommentResult"
		parameterType="java.lang.Integer">
		select * from comment
		where board_seq = #{board_seq}
		order by step
	</select>

	<insert id="insertNewComment" parameterType="com.kitri.daily.board.Comment">
		insert into comment
		(`board_seq`,`ref`,`lev`,`step`,`pseq`,`reply`,`content`,`writer`)
		select #{board_seq} ,ifnull(max(ref),0)+1, 0 , ifnull(max(step)+1,0) , 0 , 0
		,#{content},#{writer} from comment
		where board_seq = #{board_seq};
	</insert>

	<insert id="insertRepComment" parameterType="com.kitri.daily.board.Comment">
		<!-- 자 여기부터 트렌젝션 처리해야한다.... -->
	</insert>
</mapper>