<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kitri.daily.search.SearchMapper">

	<resultMap id="LookResult" type="com.kitri.daily.search.Look">
		<result column="row" property="row" />
		<result column="board_seq" property="board_seq" />
		<result column="img1" property="img1" />
	</resultMap>

	<resultMap id="BoardResult" type="com.kitri.daily.board.Board">
		<result column="board_seq" property="board_seq" />
		<result column="writer" property="writer" />
		<result column="content" property="content" />
		<result column="posted" property="posted" />
		<result column="img1" property="img1" />
		<result column="img2" property="img2" />
		<result column="img3" property="img3" />
		<result column="img4" property="img4" />
		<result column="img5" property="img5" />
		<result column="public_yn" property="public_yn" />
	</resultMap>

	<select id="getLookCnt" resultType="java.util.Map"
		parameterType="String">
		select count(*) cnt from like_siren
		where sender = #{id}
		union
		select count(*) from relationship
		where sender = #{id}
		and status
		in ('y','r')
	</select>

	<select id="getLook" resultMap="LookResult">
		select @rownum:=@rownum+1 As
		row,b.board_seq , b.img from
		(select * from board
		where board_seq in(
		select a.board_seq from
		(select board_seq, count(sender) AS likecnt from like_siren
		where board_seq in(
		select board_seq from board
		where posted >= date_add(now(), interval -1 month)
		and public_yn = 'y'
		order by posted desc
		)
		group by board_seq
		order by likecnt desc) a
		)
		order by field(board_seq,
		'select a.board_seq from
		(select board_seq, count(sender) AS likecnt from like_siren
		where board_seq in(
		select board_seq from board
		where posted >= date_add(now(), interval -1 month)
		and public_yn = ''y''
		order by posted desc
		)
		group by board_seq
		order by likecnt desc) a
		'
		)) b , (select @rownum:=0) tmp
		limit 0,9;
	</select>

</mapper>